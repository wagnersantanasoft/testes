<!-- Exemplo funcional: vídeo da câmera exibido na tela com leitura de código de barras -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Leitor de Código de Barras</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background: #f0f4f8;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .container {
            max-width: 400px;
            margin: 40px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            padding: 24px;
            text-align: center;
        }
        video {
            width: 100%;
            max-width: 360px;
            border-radius: 8px;
            margin-bottom: 16px;
            background: #222;
        }
        #codigo {
            font-size: 1.2em;
            color: #0074d9;
            margin-top: 12px;
            padding: 10px;
            word-break: break-all;
        }
        button {
            background: #0074d9;
            color: #fff;
            border: none;
            padding: 12px 0;
            width: 100%;
            border-radius: 6px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 12px;
        }
        button:disabled {
            background: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="imagens/sanatanasoft_full_p.png" alt="">
        <h2>Leitor de Código de Barras</h2>
        <video id="video" autoplay playsinline></video>
        <div id="codigo"></div>
        <button id="iniciar">Iniciar Leitura</button>
        <button id="parar" style="display:none;background:#ff4136;">Parar</button>
    </div>
    <script>
        const video = document.getElementById('video');
        const iniciarBtn = document.getElementById('iniciar');
        const pararBtn = document.getElementById('parar');
        const codigoDiv = document.getElementById('codigo');
        let scanning = false;
        let stream = null;

        function getConstraints() {
            if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                return {
                    video: {
                        facingMode: { exact: "environment" },
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                };
            }
            return { video: { facingMode: "environment" } };
        }

        iniciarBtn.onclick = async function() {
            iniciarBtn.disabled = true;
            pararBtn.style.display = 'inline-block';
            codigoDiv.textContent = '';
            await startCamera();
            startScanner();
        };

        pararBtn.onclick = function() {
            stopScanner();
            stopCamera();
        };

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia(getConstraints());
                video.srcObject = stream;
                await video.play();
            } catch (err) {
                alert("Erro ao acessar a câmera: " + err);
                iniciarBtn.disabled = false;
                pararBtn.style.display = 'none';
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            video.srcObject = null;
        }

        function startScanner() {
            scanning = true;
            if (window.Quagga) {
                Quagga.init({
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: video,
                        constraints: getConstraints().video
                    },
                    decoder: {
                        readers: [
                            "ean_reader",
                            "ean_8_reader",
                            "upc_reader",
                            "upc_e_reader"
                        ]
                    },
                    locate: true
                }, function(err) {
                    if (err) {
                        alert("Erro ao iniciar o Quagga: " + err);
                        stopScanner();
                        stopCamera();
                        return;
                    }
                    Quagga.start();
                });

                Quagga.onDetected(onDetected);
            }
        }

        function onDetected(result) {
            if (scanning && result && result.codeResult && result.codeResult.code) {
                codigoDiv.textContent = "Código lido: " + result.codeResult.code;
                stopScanner();
                stopCamera();
            }
        }

        function stopScanner() {
            scanning = false;
            try { Quagga.stop(); } catch (e) {}
            iniciarBtn.disabled = false;
            pararBtn.style.display = 'none';
            if (window.Quagga) Quagga.offDetected(onDetected);
        }
    </script>
    <!-- QuaggaJS CDN -->
    <script src="https://unpkg.com/@ericblade/quagga2@1.2.6/dist/quagga.min.js"></script>
</body>
</html>